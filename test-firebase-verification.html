<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Verification Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Firebase Verification Test</h1>
        
        <div class="test-section">
            <h2>1. Test Firebase Connection</h2>
            <button onclick="testConnection()">Test Connection</button>
            <div id="connectionResult"></div>
        </div>
        
        <div class="test-section">
            <h2>2. Test Data Access</h2>
            <button onclick="testDataAccess()">Test Data Access</button>
            <div id="dataResult"></div>
        </div>
        
        <div class="test-section">
            <h2>3. Test Write Data</h2>
            <button onclick="testWriteData()">Test Write Data</button>
            <div id="writeResult"></div>
        </div>
        
        <div class="test-section">
            <h2>4. Check Current Data</h2>
            <button onclick="checkCurrentData()">Check Current Data</button>
            <div id="currentDataResult"></div>
        </div>
    </div>

    <script type="module">
        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get, set, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAJhkCyNT0be2x6FSzyUz0Ye9xX-QihIBo",
            authDomain: "bijaksampah-aeb82.firebaseapp.com",
            databaseURL: "https://bijaksampah-aeb82-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "bijaksampah-aeb82",
            storageBucket: "bijaksampah-aeb82.firebasestorage.app",
            messagingSenderId: "140467230562",
            appId: "1:140467230562:web:19a34dfefcb6f65bd7fe3b"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.testConnection = async function() {
            const resultDiv = document.getElementById('connectionResult');
            try {
                resultDiv.innerHTML = '<span class="info">Testing connection...</span>';
                
                const testRef = ref(database, 'test');
                await get(testRef);
                
                resultDiv.innerHTML = '<span class="success">✅ Firebase connection successful!</span>';
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ Connection failed: ${error.message}</span>`;
            }
        };

        window.testDataAccess = async function() {
            const resultDiv = document.getElementById('dataResult');
            try {
                resultDiv.innerHTML = '<span class="info">Testing data access...</span>';
                
                // Test different paths
                const paths = [
                    'users verification',
                    'user verification', 
                    'UsersData',
                    'test'
                ];
                
                let results = '';
                for (const path of paths) {
                    try {
                        const dataRef = ref(database, path);
                        const snapshot = await get(dataRef);
                        if (snapshot.exists()) {
                            results += `<div class="success">✅ Path "${path}": Data found (${Object.keys(snapshot.val()).length} items)</div>`;
                        } else {
                            results += `<div class="info">ℹ️ Path "${path}": No data found</div>`;
                        }
                    } catch (error) {
                        results += `<div class="error">❌ Path "${path}": Error - ${error.message}</div>`;
                    }
                }
                
                resultDiv.innerHTML = results;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ Data access test failed: ${error.message}</span>`;
            }
        };

        window.testWriteData = async function() {
            const resultDiv = document.getElementById('writeResult');
            try {
                resultDiv.innerHTML = '<span class="info">Testing write data...</span>';
                
                const testData = {
                    email: 'test@example.com',
                    role: 'Test User',
                    createdAt: Date.now(),
                    test: true
                };
                
                const testRef = ref(database, 'test/users/verification-test');
                await set(testRef, testData);
                
                resultDiv.innerHTML = '<span class="success">✅ Test data written successfully!</span>';
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ Write test failed: ${error.message}</span>`;
            }
        };

        window.checkCurrentData = async function() {
            const resultDiv = document.getElementById('currentDataResult');
            try {
                resultDiv.innerHTML = '<span class="info">Checking current data...</span>';
                
                const verificationRef = ref(database, 'users verification');
                const snapshot = await get(verificationRef);
                
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    const userCount = Object.keys(data).length;
                    
                    let userDetails = '';
                    Object.keys(data).forEach((key, index) => {
                        if (index < 5) { // Show first 5 users
                            const user = data[key];
                            userDetails += `
                                <div style="margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                                    <strong>User ID:</strong> ${key}<br>
                                    <strong>Email:</strong> ${user.email || 'N/A'}<br>
                                    <strong>Role:</strong> ${user.role || 'N/A'}<br>
                                    <strong>Created:</strong> ${user.createdAt ? new Date(parseInt(user.createdAt)).toLocaleString() : 'N/A'}<br>
                                    <strong>Verified:</strong> ${user.verified ? 'Yes' : 'No'}<br>
                                </div>
                            `;
                        }
                    });
                    
                    if (userCount > 5) {
                        userDetails += `<div style="margin: 10px 0; color: #666;">... and ${userCount - 5} more users</div>`;
                    }
                    
                    resultDiv.innerHTML = `
                        <div class="success">✅ Found ${userCount} users in verification database</div>
                        <h4>User Details:</h4>
                        ${userDetails}
                    `;
                } else {
                    resultDiv.innerHTML = '<span class="info">ℹ️ No users found in verification database</span>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ Failed to check data: ${error.message}</span>`;
            }
        };
    </script>
</body>
</html>
